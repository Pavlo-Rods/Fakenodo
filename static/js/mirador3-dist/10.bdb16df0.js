(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1080:function(t,e,n){"use strict";n.r(e);var o=n(9),r=n(10),i=n(905),a=n(7),s=n(11),c=n.n(s),l=n(13),u=n(0),d=n.n(u),f=n(291),v=n.n(f),h=n(283),p=n.n(h),y=n(974),g=n.n(y),w=n(54),b=n.n(w),m=n(37),O=n(16),A=n.n(O),j=n(1048),I=n.n(j),C=n(1054),k=n.n(C);function x(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,P(o.key),o)}}function P(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var S=function(){return t=function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.viewer=e,this.ref=n,this.containerWidth=0,this.containerHeight=0,this.imgAspectRatio=1},(e=[{key:"canvas",get:function(){return this.canvasDiv.firstElementChild}},{key:"canvasDiv",get:function(){return this.ref.current}},{key:"context2d",get:function(){return this.canvas.getContext("2d")}},{key:"clear",value:function(){this.context2d.clearRect(0,0,this.containerWidth,this.containerHeight)}},{key:"resize",value:function(){this.containerWidth!==this.viewer.container.clientWidth&&(this.containerWidth=this.viewer.container.clientWidth,this.canvasDiv.setAttribute("width",this.containerWidth),this.canvas.setAttribute("width",this.containerWidth)),this.containerHeight!==this.viewer.container.clientHeight&&(this.containerHeight=this.viewer.container.clientHeight,this.canvasDiv.setAttribute("height",this.containerHeight),this.canvas.setAttribute("height",this.containerHeight)),this.viewportOrigin=new g.a.Point(0,0);var t=this.viewer.viewport.getBoundsNoRotate(!0);this.viewportOrigin.x=t.x,this.viewportOrigin.y=t.y*this.imgAspectRatio,this.viewportWidth=t.width,this.viewportHeight=t.height*this.imgAspectRatio;var e=this.viewer.world.getItemAt(0);e&&(this.imgWidth=e.source.dimensions.x,this.imgHeight=e.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight)}},{key:"canvasUpdate",value:function(t){var e=this.viewer.viewport.getZoom(!0),n=this.viewer.world.getItemAt(0);if(n){var o=n.viewportToImageZoom(e),r=(this.viewportOrigin.x/this.imgWidth-this.viewportOrigin.x)/this.viewportWidth*this.containerWidth,i=(this.viewportOrigin.y/this.imgHeight-this.viewportOrigin.y)/this.viewportHeight*this.containerHeight;this.clearBeforeRedraw&&this.clear(),this.context2d.translate(r,i),this.context2d.scale(o,o);var a=this.viewer.viewport.getCenter();this.viewer.viewport.getFlip()&&(this.context2d.translate(2*a.x,0),this.context2d.scale(-1,1));var s=this.viewer.viewport.getRotation();0!==s&&(this.context2d.translate(a.x,a.y),this.context2d.rotate(s*Math.PI/180),this.context2d.translate(-1*a.x,-1*a.y)),t(),this.context2d.setTransform(1,0,0,1,0,0)}}}])&&x(t.prototype,e),n&&x(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function T(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return R(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,M(o.key),o)}}function M(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}var W=function(){return t=function t(e){var n=e.resource,o=e.palette,r=e.zoomRatio,i=e.offset,a=e.selected,s=e.hovered;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resource=n,this.palette=o,this.zoomRatio=r,this.offset=i,this.selected=a,this.hovered=s},(e=[{key:"toContext",value:function(t){this.context=t,this.resource.svgSelector?this.svgContext():this.resource.fragmentSelector&&this.fragmentContext()}},{key:"svgString",get:function(){return this.resource.svgSelector.value}},{key:"svgContext",value:function(){var t,e=this;0!==(t=this.hovered?this.palette.hovered:this.selected?this.palette.selected:this.palette.default).globalAlpha&&T(this.svgPaths).forEach((function(n){e.context.save(),e.context.translate(e.offset.x,e.offset.y);var o=new Path2D(n.attributes.d.nodeValue);e.context.strokeStyle=e.color,n.attributes["stroke-dasharray"]&&e.context.setLineDash(n.attributes["stroke-dasharray"].nodeValue.split(","));var r={fill:"fillStyle",stroke:"strokeStyle","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterlimit","stroke-width":"lineWidth"};Object.keys(r).forEach((function(t){n.attributes[t]&&(e.context[r[t]]=n.attributes[t].nodeValue)})),e.context.lineWidth/=e.zoomRatio,(e.selected||e.hovered)&&(e.context.strokeStyle=t.strokeStyle||t.fillStyle),n.attributes["stroke-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["stroke-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.stroke(o),n.attributes.fill&&"none"!==n.attributes.fill.nodeValue&&(n.attributes["fill-opacity"]?e.context.globalAlpha=t.globalAlpha*n.attributes["fill-opacity"].nodeValue:e.context.globalAlpha=t.globalAlpha,e.context.fill(o)),e.context.restore()}))}},{key:"fragmentContext",value:function(){var t,e,n,o=this,r=this.resource.fragmentSelector;(r[0]+=this.offset.x,r[1]+=this.offset.y,t=this.selected?this.palette.selected:this.hovered?this.palette.hovered:this.palette.default,this.context.save(),Object.keys(t).forEach((function(e){o.context[e]=t[e]})),0!==t.globalAlpha)&&(t.fillStyle?(e=this.context).fillRect.apply(e,T(r)):(this.context.lineWidth=1/this.zoomRatio,(n=this.context).strokeRect.apply(n,T(r))),this.context.restore())}},{key:"svgPaths",get:function(){return(new DOMParser).parseFromString(this.svgString,"text/xml").getElementsByTagName("path")}}])&&E(t.prototype,e),n&&E(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,n}();function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function H(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){z(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function z(t,e,n){return(e=N(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function V(t){return function(t){if(Array.isArray(t))return B(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,i,a,s=[],c=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=i.call(n)).done)&&(s.push(o.value),s.length!==e);c=!0);}catch(t){l=!0,r=t}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return s}}(t,e)||_(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){if(t){if("string"==typeof t)return B(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?B(t,e):void 0}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function F(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,N(o.key),o)}}function N(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function Z(t,e,n){return e=J(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,n||[],J(t).constructor):e.apply(t,n))}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $(t,e){return($=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var X=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=Z(this,e,[t])).ref=d.a.createRef(),n.osdCanvasOverlay=null,n.updateCanvas=function(){},n.onUpdateViewport=n.onUpdateViewport.bind(n),n.onCanvasClick=n.onCanvasClick.bind(n),n.onCanvasMouseMove=v()(n.onCanvasMouseMove.bind(n),10),n.onCanvasExit=n.onCanvasExit.bind(n),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$(t,e)}(e,t),n=e,r=[{key:"annotationsMatch",value:function(t,e){return!t&&!e||!(t&&!e||!t&&e)&&(0===t.length&&0===e.length||t.length===e.length&&t.every((function(t,n){var o=t.resources.map((function(t){return t.id})),r=e[n].resources.map((function(t){return t.id}));return 0===o.length&&0===r.length||o.length===r.length&&!(t.id!==e[n].id||!p()(o,r))})))}}],(o=[{key:"componentDidMount",value:function(){this.initializeViewer()}},{key:"componentDidUpdate",value:function(t){var n=this.props,o=n.drawAnnotations,r=n.drawSearchAnnotations,i=n.annotations,a=n.searchAnnotations,s=n.hoveredAnnotationIds,c=n.selectedAnnotationId,l=n.highlightAllAnnotations,u=n.viewer;this.initializeViewer();var d=!e.annotationsMatch(i,t.annotations),f=!e.annotationsMatch(a,t.searchAnnotations),v=k()(s,t.hoveredAnnotationIds).length>0;this.osdCanvasOverlay&&v&&(s.length>0?this.osdCanvasOverlay.canvasDiv.style.cursor="pointer":this.osdCanvasOverlay.canvasDiv.style.cursor="");var h=c!==t.selectedAnnotationId,p=o!==t.drawAnnotations||r!==t.drawSearchAnnotations||l!==t.highlightAllAnnotations;(f||d||h||v||p)&&(this.updateCanvas=this.canvasUpdateCallback(),u.forceRedraw())}},{key:"componentWillUnmount",value:function(){var t=this.props.viewer;t.removeHandler("canvas-click",this.onCanvasClick),t.removeHandler("canvas-exit",this.onCanvasExit),t.removeHandler("update-viewport",this.onUpdateViewport),t.removeHandler("mouse-move",this.onCanvasMouseMove)}},{key:"onCanvasClick",value:function(t){var e=this,n=this.props.canvasWorld,o=t.position,r=t.eventSource.viewport.pointFromPixel(o),i=n.canvasAtPoint(r);if(i){var a=U(n.canvasToWorldCoordinates(i.id),4),s=(a[0],a[1],a[2]),c=a[3],l=this.annotationsAtPoint(i,r);if(l.length>0&&(t.preventDefaultAction=!0),1===l.length)this.toggleAnnotation(l[0].id);else if(l.length>0){var u=function(t){var n=Math.PI/180;return function(o){for(var a=0,s=0;s<360;s+=1){var c=Math.cos(s*n)*t+r.x,l=Math.sin(s*n)*t+r.y;e.isAnnotationAtPoint(o,i,{x:c,y:l})&&(a+=1)}return{anno:o,score:a}}},d=[],f=1;for(d=I()(l.map(u(f)),"score");f<Math.max(s,c)&&d[0].score===d[1].score;)f*=2,d=I()(l.map(u(f)),"score");this.toggleAnnotation(d[0].anno.id)}}}},{key:"onCanvasMouseMove",value:function(t){var e=this.props,n=e.annotations,o=e.canvasWorld,r=e.hoverAnnotation,i=e.hoveredAnnotationIds,a=e.searchAnnotations,s=e.viewer,c=e.windowId;if(0!==n.length||0!==a.length){var l=t.position,u=s.viewport.pointFromPixel(l),d=o.canvasAtPoint(u);if(d){var f=this.annotationsAtPoint(d,u);k()(i,f.map((function(t){return t.id}))).length>0&&r(c,f.map((function(t){return t.id})))}else r(c,[])}}},{key:"onCanvasExit",value:function(t){var e=this.props,n=e.hoverAnnotation,o=e.windowId;this.onCanvasMouseMove.cancel(),n(o,[])}},{key:"onUpdateViewport",value:function(t){this.updateCanvas()}},{key:"initializeViewer",value:function(){var t=this.props.viewer;t&&(this.osdCanvasOverlay||(this.osdCanvasOverlay=new S(t,this.ref),t.addHandler("canvas-click",this.onCanvasClick),t.addHandler("canvas-exit",this.onCanvasExit),t.addHandler("update-viewport",this.onUpdateViewport),t.addHandler("mouse-move",this.onCanvasMouseMove),this.updateCanvas=this.canvasUpdateCallback()))}},{key:"canvasUpdateCallback",value:function(){var t=this;return function(){t.osdCanvasOverlay.clear(),t.osdCanvasOverlay.resize(),t.osdCanvasOverlay.canvasUpdate(t.renderAnnotations.bind(t))}}},{key:"isAnnotationAtPoint",value:function(t,e,n){var o=U(this.props.canvasWorld.canvasToWorldCoordinates(e.id),2),r=o[0],i=o[1],a=n.x-r,s=n.y-i;if(t.svgSelector){var c=this.osdCanvasOverlay.context2d;return V(new W({resource:t}).svgPaths).some((function(t){return c.isPointInPath(new Path2D(t.attributes.d.nodeValue),a,s)}))}if(t.fragmentSelector){var l=U(t.fragmentSelector,4),u=l[0],d=l[1],f=l[2],v=l[3];return u<=a&&a<=u+f&&d<=s&&s<=d+v}return!1}},{key:"annotationsAtPoint",value:function(t,e){var n=this,o=this.props,r=o.annotations,i=o.searchAnnotations,a=[].concat(V(r),V(i));return c()(a.map((function(t){return t.resources}))).filter((function(o){return t.id===o.targetId&&n.isAnnotationAtPoint(o,t,e)}))}},{key:"toggleAnnotation",value:function(t){var e=this.props,n=e.selectedAnnotationId,o=e.selectAnnotation,r=e.deselectAnnotation,i=e.windowId;n===t?r(i,t):o(i,t)}},{key:"annotationsToContext",value:function(t,e){var n=this.props,o=n.highlightAllAnnotations,r=n.hoveredAnnotationIds,i=n.selectedAnnotationId,a=n.canvasWorld,s=n.viewer,c=this.osdCanvasOverlay.context2d,l=s.viewport.getZoom(!0)/s.viewport.getMaxZoom();t.forEach((function(t){t.resources.forEach((function(t){if(a.canvasIds.includes(t.targetId)){var n=a.offsetByCanvas(t.targetId);new W({hovered:r.includes(t.id),offset:n,palette:H(H({},e),{},{default:H(H({},e.default),!o&&e.hidden)}),resource:t,selected:i===t.id,zoomRatio:l}).toContext(c)}}))}))}},{key:"renderAnnotations",value:function(){var t=this.props,e=t.annotations,n=t.drawAnnotations,o=t.drawSearchAnnotations,r=t.searchAnnotations,i=t.palette;o&&this.annotationsToContext(r,i.search),n&&this.annotationsToContext(e,i.annotations)}},{key:"render",value:function(){var t=this.props.viewer;return t?A.a.createPortal(d.a.createElement("div",{ref:this.ref,style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"}},d.a.createElement("canvas",null)),t.canvas):d.a.createElement(d.a.Fragment,null)}}])&&F(n.prototype,o),r&&F(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,r}(u.Component);X.defaultProps={annotations:[],deselectAnnotation:function(){},drawAnnotations:!0,drawSearchAnnotations:!0,highlightAllAnnotations:!1,hoverAnnotation:function(){},hoveredAnnotationIds:[],palette:{},searchAnnotations:[],selectAnnotation:function(){},selectedAnnotationId:void 0,viewer:null};var Y=n(335),q=n(424),L=n(422),G=n(67),K=n(90),Q=n(25),tt=n(414),et={deselectAnnotation:Y.a,hoverAnnotation:Y.b,selectAnnotation:Y.g},nt=Object(o.compose)(Object(i.a)(),Object(r.b)((function(t,e){var n=e.windowId;return{annotations:Object(q.d)(t,{windowId:n}),canvasWorld:Object(L.a)(t,{windowId:n}),drawAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(K.e)(t,{content:"annotations",windowId:n}).length>0,drawSearchAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(K.e)(t,{content:"search",windowId:n}).length>0,highlightAllAnnotations:Object(Q.e)(t,{windowId:n}).highlightAllAnnotations,hoveredAnnotationIds:Object(Q.e)(t,{windowId:n}).hoveredAnnotationIds,palette:Object(G.g)(t).palette,searchAnnotations:Object(tt.f)(t,{windowId:n}),selectedAnnotationId:Object(q.e)(t,{windowId:n})}}),et),Object(l.a)("AnnotationsOverlay"))(X),ot=n(93),rt=n(272);function it(t,e,n){if(ht())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var r=new(t.bind.apply(t,o));return n&&yt(r,n.prototype),r}function at(t){return function(t){if(Array.isArray(t))return st(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return st(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?st(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function st(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function lt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach((function(e){ut(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ut(t,e,n){return(e=ft(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function dt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ft(o.key),o)}}function ft(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function vt(t,e,n){return e=pt(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ht()?Reflect.construct(e,n||[],pt(t).constructor):e.apply(t,n))}function ht(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(ht=function(){return!!t})()}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yt(t,e){return(yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var gt=function(t){function e(t){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=vt(this,e,[t])).state={viewer:void 0},n.ref=d.a.createRef(),n.apiRef=d.a.createRef(),rt.a.set(t.windowId,n.apiRef),n.onCanvasMouseMove=v()(n.onCanvasMouseMove.bind(n),10),n.onViewportChange=n.onViewportChange.bind(n),n.zoomToWorld=n.zoomToWorld.bind(n),n.osdUpdating=!1,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yt(t,e)}(e,t),function(t,e,n){return e&&dt(t.prototype,e),n&&dt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.osdConfig,o=e.t,r=e.windowId;if(this.ref.current){var i=new g.a(lt({id:this.ref.current.id},n)),a=i.canvas&&i.canvas.firstElementChild;a&&(a.setAttribute("role","img"),a.setAttribute("aria-label",o("digitizedView")),a.setAttribute("aria-describedby","".concat(r,"-osd"))),this.apiRef.current=i,this.setState({viewer:i}),i.addHandler("animation-start",(function(){t.osdUpdating=!0})),i.addHandler("animation-finish",this.onViewportChange),i.addHandler("animation-finish",(function(){t.osdUpdating=!1})),i.innerTracker&&(i.innerTracker.moveHandler=this.onCanvasMouseMove)}}},{key:"componentDidUpdate",value:function(t,e){var n=this.props,o=n.viewerConfig,r=n.canvasWorld,i=this.state.viewer;if(this.apiRef.current=i,void 0===e.viewer)return o&&(i.viewport.panTo(o,!0),i.viewport.zoomTo(o.zoom,o,!0),void 0!==o.degrees&&i.viewport.setRotation(o.degrees),void 0!==o.flip&&i.viewport.setFlip(o.flip)),void this.addAllImageSources(!o);if(this.infoResponsesMatch(t.infoResponses)&&this.nonTiledImagedMatch(t.nonTiledImages))if(p()(r.layers,t.canvasWorld.layers)){if(o&&!this.osdUpdating){var a=i.viewport;o.x===a.centerSpringX.target.value&&o.y===a.centerSpringY.target.value||a.panTo(o,!1),o.zoom!==a.zoomSpring.target.value&&a.zoomTo(o.zoom,o,!1),o.rotation!==a.getRotation()&&a.setRotation(o.rotation),o.flip!==a.getFlip()&&a.setFlip(o.flip)}}else this.refreshTileProperties();else{i.close();var s=!p()(r.canvasIds,t.canvasWorld.canvasIds);this.addAllImageSources(s||!o)}}},{key:"componentWillUnmount",value:function(){var t=this.state.viewer;t.innerTracker&&t.innerTracker.moveHandler===this.onCanvasMouseMove&&(t.innerTracker.moveHandler=null),t.removeAllHandlers(),this.apiRef.current=void 0}},{key:"onCanvasMouseMove",value:function(t){this.state.viewer.raiseEvent("mouse-move",t)}},{key:"onViewportChange",value:function(t){var e=this.props,n=e.updateViewport,o=e.windowId,r=t.eventSource.viewport;n(o,{flip:r.getFlip(),rotation:r.getRotation(),x:Math.round(r.centerSpringX.target.value),y:Math.round(r.centerSpringY.target.value),zoom:r.zoomSpring.target.value})}},{key:"addAllImageSources",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=this.props,o=n.nonTiledImages,r=n.infoResponses;Promise.all(r.map((function(e){return t.addTileSource(e)})),o.map((function(e){return t.addNonTiledImage(e)}))).then((function(){(r[0]||o[0])&&(e&&t.zoomToWorld(),t.refreshTileProperties())}))}},{key:"addNonTiledImage",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer,o=t.getProperty("type"),r=t.getProperty("format")||"";return"Image"===o||"dctypes:Image"===o||r.startsWith("image/")?new Promise((function(o,r){n||r(),n.addSimpleImage({error:function(t){return r(t)},fitBounds:it(g.a.Rect,at(e.contentResourceToWorldCoordinates(t))),index:e.layerIndexOfImageResource(t),opacity:e.layerOpacityOfImageResource(t),success:function(t){return o(t)},url:t.id})})):Promise.resolve()}},{key:"addTileSource",value:function(t){var e=this.props.canvasWorld,n=this.state.viewer;return new Promise((function(o,r){n||r();var i=lt({},t.json),a=e.contentResource(t.id);a&&n.addTiledImage({error:function(t){return r(t)},fitBounds:it(g.a.Rect,at(e.contentResourceToWorldCoordinates(a))),index:e.layerIndexOfImageResource(a),opacity:e.layerOpacityOfImageResource(a),success:function(t){return o(t)},tileSource:i})}))}},{key:"refreshTileProperties",value:function(){for(var t=this.props.canvasWorld,e=this.state.viewer.world,n=[],o=0;o<e.getItemCount();o+=1)n.push(e.getItemAt(o));n.forEach((function(n,o){var r=t.contentResource(n.source["@id"]||n.source.id);if(r){var i=t.layerIndexOfImageResource(r);o!==i&&e.setItemIndex(n,i),n.setOpacity(t.layerOpacityOfImageResource(r))}}))}},{key:"fitBounds",value:function(t,e,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=this.state.viewer;i.viewport.fitBounds(new g.a.Rect(t,e,n,o),r)}},{key:"infoResponsesMatch",value:function(t){var e=this.props.infoResponses;return 0===e.length&&0===t.length||e.length===t.length&&e.every((function(e,n){return!!t[n]&&(!(!e.json||!t[n].json)&&(e.tokenServiceId===t[n].tokenServiceId&&(!(!e.json["@id"]||e.json["@id"]!==t[n].json["@id"])||!(!e.json.id||e.json.id!==t[n].json.id))))}))}},{key:"nonTiledImagedMatch",value:function(t){var e=this.props.nonTiledImages;return 0===e.length&&0===t.length||e.some((function(e,n){return!!t[n]&&e.id===t[n].id}))}},{key:"zoomToWorld",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.props.canvasWorld;this.fitBounds.apply(this,at(e.worldBounds()).concat([t]))}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,o=e.classes,r=e.label,i=e.t,a=e.windowId,s=e.drawAnnotations,c=this.state.viewer,l=d.a.Children.map(n,(function(e){return d.a.cloneElement(e,{zoomToWorld:t.zoomToWorld})}));return d.a.createElement(d.a.Fragment,null,d.a.createElement("section",{className:b()(Object(m.a)("osd-container"),o.osdContainer),id:"".concat(a,"-osd"),ref:this.ref,"aria-label":i("item",{label:r}),"aria-live":"polite"},s&&d.a.createElement(nt,{viewer:c,windowId:a}),l,d.a.createElement(ot.a,Object.assign({viewer:c},lt(lt({},this.props),{},{children:null})))))}}])}(u.Component);gt.defaultProps={children:null,drawAnnotations:!1,infoResponses:[],label:null,nonTiledImages:[],osdConfig:{},viewerConfig:null};var wt=n(385),bt=n(32),mt={updateViewport:wt.d},Ot=Object(o.compose)(Object(a.a)({osdContainer:{flex:1,position:"relative"}}),Object(i.a)(),Object(r.b)((function(t,e){var n=e.windowId,o=Object(L.a)(t,{windowId:n}),r=Object(bt.q)(t),i=c()(o.canvases.map((function(t){return t.imageServiceIds})));return{canvasWorld:o,drawAnnotations:Object(G.a)(t).window.forceDrawAnnotations||Object(K.e)(t,{content:"annotations",windowId:n}).length>0||Object(K.e)(t,{content:"search",windowId:n}).length>0,infoResponses:i.map((function(t){return r[t]})).filter((function(t){return void 0!==t&&!1===t.isFetching&&void 0===t.error})),label:Object(bt.e)(t,{canvasId:(Object(bt.g)(t,{windowId:n})||{}).id,windowId:n}),nonTiledImages:Object(bt.m)(t,{windowId:n}),osdConfig:Object(G.a)(t).osdConfig,viewerConfig:Object(Q.d)(t,{windowId:n})}}),mt),Object(l.a)("OpenSeadragonViewer"));e.default=Ot(gt)}}]);
//# sourceMappingURL=10.bdb16df0.js.map